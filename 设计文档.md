# 📄 VSCode 插件设计文档：关键词交集搜索

## 1. 插件目标

在 VSCode 中提供一个增强型搜索功能，支持输入多个关键词，并快速筛选出 **同时包含所有关键词的文件**（文件级交集）。
相比 VSCode 自带的搜索（单关键词或正则），本插件能直接返回交集文件列表，极大提升查找效率。

---

## 2. 功能需求

### 🎯 核心功能

1. 用户输入多个关键词（如：`项目代码`、`项目名称`）。
2. 插件扫描当前工作区所有文件。
3. 判断哪些文件同时包含所有关键词。
4. 在 VSCode 的侧边栏或输出面板中，展示交集文件列表。
5. 支持点击文件名 → 打开文件，并自动高亮匹配词。

### 🔧 扩展功能（后续迭代）

* 支持 **关键词个数不限**（2 个以上都行）。
* 支持 **大小写敏感 / 不敏感** 切换。
* 支持 **忽略的文件或文件夹**（可配置 `.gitignore` 风格）。
* 支持 **高亮显示所有关键词**。
* 支持 **正则关键词**（如 `项目.*`）。

---

## 3. 用户交互设计

### 3.1 命令调用

* 用户在命令面板（`Ctrl+Shift+P`）里输入：
  `交集搜索: 搜索多个关键词`
* 弹出输入框（`window.showInputBox`）：

  * 提示语：`请输入关键词（多个词用空格分隔，例如：项目代码 项目名称）`

### 3.2 结果展示

* 搜索完成后，在 **侧边栏 View 或 Output 窗口** 显示结果。
* 展示形式：

```
找到 3 个文件同时包含 [项目代码, 项目名称]:

1. src/components/ContractForm.vue
2. src/views/ProjectList.vue
3. src/utils/contractHelper.js
```

* 点击文件名 → 打开文件 → 自动跳转到第一个匹配位置。

---

## 4. 技术设计

### 4.1 项目结构

```
vscode-keywords-intersection/
├── package.json        # 插件配置，命令/视图定义
├── src/
│   ├── extension.ts    # 插件入口，命令注册
│   ├── search.ts       # 核心搜索逻辑
│   └── utils.ts        # 文件读取、关键词匹配工具
├── media/              # UI 图标、样式
└── README.md           # 使用说明
```

### 4.2 主要模块

#### 4.2.1 插件入口 `extension.ts`

* 注册命令：`extension.intersectionSearch`
* 调用 `search.ts` 中的搜索方法。
* 处理用户输入，调用结果展示。

#### 4.2.2 搜索逻辑 `search.ts`

* 获取工作区内所有文件（`workspace.findFiles`）。
* 逐个读取文件内容（`fs.readFile`）。
* 检查是否包含所有关键词：

```ts
function containsAllKeywords(content: string, keywords: string[]): boolean {
  return keywords.every(k => content.includes(k));
}
```

* 记录匹配的文件路径。
* 返回结果数组。

#### 4.2.3 结果展示

* 使用 `window.showQuickPick` 简单展示，或：
* 注册一个 **侧边栏 View**（TreeView API）展示文件树，点击可打开。

---

## 5. 配置项设计

在 `package.json` 里定义可配置项：

```json
"contributes": {
  "configuration": {
    "title": "交集搜索",
    "properties": {
      "intersectionSearch.ignorePatterns": {
        "type": "array",
        "default": ["**/node_modules/**", "**/.git/**"],
        "description": "忽略搜索的文件或目录"
      },
      "intersectionSearch.caseSensitive": {
        "type": "boolean",
        "default": false,
        "description": "是否区分大小写"
      }
    }
  }
}
```

---

## 6. 示例流程

1. 用户按 `Ctrl+Shift+P` → 输入命令 **交集搜索**。
2. 输入关键词：

   ```
   项目代码 项目名称
   ```
3. 插件开始搜索工作区文件。
4. 结果显示：

   ```
   找到 3 个文件：
   - src/components/ContractForm.vue
   - src/views/ProjectList.vue
   - src/utils/contractHelper.js
   ```
5. 用户点击文件 → 自动跳转。

---

## 7. 后续优化

* 支持 **搜索结果缓存**，避免大项目反复全盘扫描。
* 支持 **交集 + 排除关键字**（例如：包含 A 和 B，但不包含 C）。
* UI 上可考虑 **搜索结果面板**，类似 VSCode 原生搜索结果。
