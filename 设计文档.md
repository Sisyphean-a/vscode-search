# 📄 VSCode 关键词交集搜索扩展 - 项目设计文档

## 1. 项目概述

### 1.1 项目目标
在 VSCode 中提供一个增强型搜索功能，支持输入多个关键词，并快速筛选出 **同时包含所有关键词的文件**（文件级交集）。相比 VSCode 自带的搜索（单关键词或正则），本扩展能直接返回交集文件列表，极大提升查找效率。

### 1.2 项目信息
- **扩展名称**: vscode-keywords-intersection
- **显示名称**: 关键词交集搜索
- **版本**: 1.0.0
- **开发语言**: TypeScript
- **目标平台**: VSCode 1.74.0+

---

## 2. 当前实现状态

### 2.1 ✅ 已完成的核心功能

#### 🔍 多关键词交集搜索
- ✅ 支持输入多个关键词（空格分隔）
- ✅ 文件内容扫描和关键词匹配
- ✅ 批量处理优化，支持大型项目
- ✅ 实时进度显示和取消支持
- ✅ 智能文件过滤（支持包含/排除模式）

#### 🎯 用户界面实现
- ✅ **命令面板集成**: `Ctrl+Shift+P` → "交集搜索"
- ✅ **快速选择器**: 搜索结果列表展示，支持快速打开文件
- ✅ **侧边栏树视图**: 在资源管理器中显示搜索结果树
- ✅ **输出面板**: 详细的搜索统计和匹配信息
- ✅ **文件高亮**: 打开文件时自动高亮匹配关键词

#### ⚙️ 配置系统
- ✅ 大小写敏感/不敏感切换
- ✅ 文件大小限制配置
- ✅ 文件类型包含模式配置
- ✅ 忽略文件和目录模式配置

### 2.2 📁 技术架构实现

```
vscode-search/
├── src/
│   ├── extension.ts     # ✅ 扩展入口和命令注册
│   ├── search.ts        # ✅ 核心搜索逻辑
│   ├── utils.ts         # ✅ 工具函数和配置管理
│   └── resultView.ts    # ✅ 结果展示界面
├── test-files/          # ✅ 测试文件
├── .vscode/             # ✅ VSCode配置
├── package.json         # ✅ 扩展配置
├── tsconfig.json        # ✅ TypeScript配置
└── README.md            # ✅ 项目文档
```

#### 核心模块详情
- **extension.ts**: 扩展激活、命令注册、树视图管理
- **search.ts**: 文件扫描、关键词匹配、结果处理
- **utils.ts**: 配置管理、文件操作、工具函数
- **resultView.ts**: 快速选择器、树视图、输出面板

### 2.3 🎮 当前用户交互流程

1. **启动搜索**: `Ctrl+Shift+P` → "交集搜索: 搜索多个关键词"
2. **输入关键词**: 在输入框中输入关键词（空格分隔）
3. **查看进度**: 实时进度条显示搜索状态
4. **查看结果**:
   - 快速选择器立即显示结果列表
   - 侧边栏树视图展示层级结构
   - 输出面板显示详细统计
5. **打开文件**: 点击文件名自动打开并高亮匹配内容

---

## 3. UI设计目标

### 3.1 🎯 目标UI愿景
实现类似VSCode原生搜索功能的专用UI面板，提供更直观和高效的用户体验。

### 3.2 📋 期望的UI布局

#### 主搜索面板（目标设计）
```
┌─────────────────────────────────────────┐
│ 🔍 关键词交集搜索                        │
├─────────────────────────────────────────┤
│ 关键词: [项目代码 项目名称        ] [搜索] │
│ ☑️ 区分大小写  ☑️ 包含子目录              │
├─────────────────────────────────────────┤
│ 📊 找到 3 个文件 (共 15 处匹配)           │
├─────────────────────────────────────────┤
│ 📁 src/                                 │
│   📄 components/ContractForm.vue (5)    │
│   📄 views/ProjectList.vue (3)          │
│ 📁 utils/                               │
│   📄 contractHelper.js (7)              │
├─────────────────────────────────────────┤
│ 🔧 [配置] [清除] [导出结果]              │
└─────────────────────────────────────────┘
```

### 3.3 🔄 当前实现 vs 目标UI对比

| 功能 | 当前实现 | 目标UI | 优先级 |
|------|----------|--------|--------|
| 关键词输入 | ✅ 命令面板输入框 | 🎯 专用搜索面板 | 高 |
| 结果展示 | ✅ 快速选择器 + 树视图 | 🎯 集成搜索面板 | 高 |
| 配置选项 | ✅ VSCode设置 | 🎯 面板内快速切换 | 中 |
| 统计信息 | ✅ 输出面板 | 🎯 面板内实时显示 | 中 |
| 文件预览 | ✅ 点击打开 | 🎯 面板内预览 | 低 |

---

## 4. 后续开发计划

### 4.1 🎨 UI改进计划（当前功能的UI优化）

#### 阶段1: 基础搜索面板 (优先级: 高)
- [ ] 创建专用的Webview搜索面板
- [ ] 实现关键词输入界面
- [ ] 集成搜索结果展示
- [ ] 添加基本的配置切换按钮

#### 阶段2: 交互优化 (优先级: 高)
- [ ] 实现文件列表的点击打开功能
- [ ] 添加搜索进度指示器
- [ ] 优化结果排序和分组显示
- [ ] 添加快捷键支持

#### 阶段3: 视觉优化 (优先级: 中)
- [ ] 统一VSCode主题样式
- [ ] 添加图标和视觉指示器
- [ ] 优化布局和间距
- [ ] 添加动画效果

### 4.2 🔧 技术实现方案

#### Webview面板实现
```typescript
// 新增文件: src/webviewPanel.ts
export class SearchWebviewPanel {
  private panel: vscode.WebviewPanel;

  constructor() {
    this.panel = vscode.window.createWebviewPanel(
      'intersectionSearch',
      '关键词交集搜索',
      vscode.ViewColumn.One,
      { enableScripts: true }
    );
  }

  // 渲染搜索界面
  private getWebviewContent(): string { ... }

  // 处理搜索请求
  private handleSearchRequest(keywords: string[]): void { ... }
}
```

#### HTML/CSS界面设计
```html
<!-- 搜索面板模板 -->
<div class="search-container">
  <div class="search-input-section">
    <input type="text" placeholder="输入关键词..." />
    <button class="search-btn">搜索</button>
  </div>
  <div class="search-options">
    <label><input type="checkbox" /> 区分大小写</label>
  </div>
  <div class="search-results">
    <!-- 动态生成结果列表 -->
  </div>
</div>
```

### 4.3 📅 开发时间规划

| 阶段 | 预估时间 | 主要任务 |
|------|----------|----------|
| 阶段1 | 1-2周 | Webview面板基础框架 |
| 阶段2 | 1周 | 交互功能实现 |
| 阶段3 | 1周 | 视觉优化和测试 |

---

## 5. 功能扩展规划（后期完善）

### 5.1 🚀 高级搜索功能（后期新增）
- [ ] **正则表达式支持**: 支持正则关键词（如 `项目.*`）
- [ ] **排除关键词**: 支持交集+排除模式（包含A和B，但不包含C）
- [ ] **搜索历史**: 保存和重用搜索历史
- [ ] **搜索模板**: 预定义常用搜索组合

### 5.2 🎯 性能优化（后期完善）
- [ ] **搜索结果缓存**: 避免重复扫描
- [ ] **增量搜索**: 文件变化时增量更新
- [ ] **并行处理**: 多线程文件扫描
- [ ] **索引构建**: 预建立文件内容索引

### 5.3 🔧 集成功能（后期扩展）
- [ ] **Git集成**: 只搜索已跟踪文件
- [ ] **工作区支持**: 多工作区搜索
- [ ] **远程搜索**: 支持远程文件系统
- [ ] **插件API**: 为其他扩展提供搜索API

---

## 6. 配置系统

### 6.1 当前配置选项
```json
{
  "intersectionSearch.caseSensitive": false,
  "intersectionSearch.maxFileSize": 1048576,
  "intersectionSearch.includePatterns": [
    "**/*.js", "**/*.ts", "**/*.vue", "**/*.md"
  ],
  "intersectionSearch.ignorePatterns": [
    "**/node_modules/**", "**/.git/**"
  ]
}
```

### 6.2 计划新增配置
```json
{
  "intersectionSearch.ui.showInSidebar": true,
  "intersectionSearch.ui.autoPreview": false,
  "intersectionSearch.search.maxResults": 100,
  "intersectionSearch.search.enableCache": true
}
```

---

## 7. 测试和质量保证

### 7.1 当前测试覆盖
- ✅ 基本功能测试文件（test-files/）
- ✅ TypeScript类型检查
- ✅ ESLint代码质量检查

### 7.2 计划测试扩展
- [ ] 单元测试覆盖
- [ ] UI自动化测试
- [ ] 性能基准测试
- [ ] 用户体验测试

---

## 8. 部署和发布

### 8.1 当前状态
- ✅ 本地开发环境完整
- ✅ 构建配置完成
- ✅ 基础文档齐全

### 8.2 发布准备
- [ ] 扩展市场发布准备
- [ ] 用户文档完善
- [ ] 版本管理策略
- [ ] 用户反馈收集机制

---

## 9. 总结

本项目已成功实现了关键词交集搜索的核心功能，具备完整的技术架构和用户交互体验。当前重点是为现有功能开发专用的UI面板，提升用户体验。后续可根据用户反馈和需求，逐步完善高级功能和性能优化。

**当前优先级**: UI面板开发 > 交互优化 > 功能扩展 > 性能优化
